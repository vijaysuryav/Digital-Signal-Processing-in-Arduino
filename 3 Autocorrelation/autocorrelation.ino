float x[500]={2.047539376,-12.32353446,-6.431003187,-4.970284352,0.337550387,3.708442577,7.698761573,9.067202388,11.35315875,13.90709783,16.82518646,17.05161417,17.4293532,17.73358935,17.15586888,15.90954626,13.11557172,9.169225264,6.57989569,1.831048812,-0.471448378,-3.389549557,-8.274065292,-11.45446884,-13.96808599,-18.2531035,-23.19234652,-26.31223093,-30.36763383,-33.56352671,-37.81021187,-41.07083054,-42.53301418,-46.38963315,-48.80047708,-51.43229876,-52.81892577,-55.87113976,-58.16066884,-59.70830157,-59.97559266,-62.5356492,-63.32335246,-65.64184383,-67.84718228,-69.20515642,-69.42672694,-70.74966631,-71.3026493,-71.52843402,-70.93005007,-72.53961509,-72.83448881,-74.61454048,-76.19227869,-77.23519098,-77.45839725,-78.6508106,-79.39768266,-80.23039966,-80.29178482,-80.28233188,-71.63209564,-55.32905556,-30.81862798,1.212819271,35.49383834,75.31018334,115.6242368,155.2723421,193.4393564,221.3963966,237.2938311,236.1386436,229.0191861,213.1873588,194.3355591,175.7132746,154.1511356,132.3162421,114.6502509,97.78704392,83.64659758,69.78980538,57.62642485,45.784944,35.63995833,25.55063168,19.04428513,8.972688128,2.619760495,-4.047504091,-11.11995281,-17.21825252,-20.19351313,-23.59798782,-25.72511879,-25.61135444,-27.87668066,-27.61988311,-25.45139587,-22.56227013,-18.93484663,-17.24210454,-13.7637195,-9.597512409,-5.885788351,-1.792362913,-1.106497164,0.116445938,1.568297273,2.474970187,2.757596421,2.284864303,1.399759961,-0.441709671,-3.044844449,-5.066216519,-6.542403046,-11.61157719,-15.75105346,-19.31620031,-22.02739505,-25.42299724,-29.29634021,-32.24172279,-36.45451795,-39.40577628,-42.43288352,-45.98414225,-48.68967176,-51.88451501,-54.27419072,-55.44645262,-58.21802893,-60.16508272,-62.83913532,-64.13935446,-67.21867079,-69.43362283,-70.90408428,-72.41995524,-72.98802923,-74.20419516,-75.05451459,-75.79624699,-78.16643106,-80.51945562,-81.7879328,-82.82376176,-84.26428968,-85.37471102,-85.07990323,-86.23857921,-87.63263524,-87.97467598,-87.48218148,-81.87927105,-65.36785644,-42.42302942,-13.13282673,21.19826474,58.88060375,99.89364541,140.7360487,179.9769139,209.3944142,227.8488131,233.0327887,226.8544996,212.9433643,195.6287061,177.2570505,158.236902,138.9548664,120.7691291,102.2846037,87.10116791,72.98423574,59.61255872,49.98396774,38.984172,31.00438096,21.11237193,13.2333536,4.400878168,-3.524194088,-8.812332929,-14.20307917,-20.27717121,-22.49287538,-27.81906047,-28.87588807,-29.62069643,-29.48477823,-28.99343227,-27.43031942,-24.60218334,-21.00170384,-17.1330562,-12.62652667,-10.07144672,-7.417755268,-4.235426691,-2.979132359,-2.711705256,-2.160599719,-1.963629033,-1.146892469,-2.636459225,-5.390634114,-8.279860287,-10.71341502,-13.42993836,-17.21007124,-18.78419696,-24.82061822,-27.86498066,-30.46838544,-34.44830553,-38.20109896,-42.59486382,-44.21772917,-47.0371143,-51.94099458,-54.53461299,-56.20174098,-57.45891303,-58.94964183,-65.69635416,-65.96418675,-68.27201139,-69.2787873,-71.50334576,-73.07882771,-75.5276666,-78.1168868,-78.71059225,-82.11843971,-83.27062153,-82.64456754,-86.94322982,-88.64797406,-88.31853142,-89.80946831,-90.0522969,-93.12665207,-94.76077073,-95.22931622,-92.72688726,-85.42304791,-66.71828341,-40.20537805,-8.519797277,26.94389956,65.13490598,107.3091597,147.8274263,186.4559774,213.2798205,227.5384359,230.8115603,221.8877613,208.5445529,191.5937562,171.9569261,151.1886611,133.0706799,114.5754349,95.02456525,82.89647921,68.36586155,55.38385479,46.52515535,38.3257529,27.10902558,19.65382744,11.33310363,4.134718633,-2.39817594,-7.497553896,-14.32744432,-18.35755202,-23.74420064,-26.74008926,-28.11860501,-29.247655,-29.84995404,-27.9849386,-26.55080371,-26.36701581,-23.37831649,-19.03728318,-17.54394811,-11.74430115,-10.12360031,-9.250624411,-5.337852059,-4.654069837,-5.673778163,-5.168092555,-5.106875388,-6.349333683,-7.03696423,-9.260176673,-13.54429092,-16.30409261,-19.24356776,-21.71900649,-25.79938776,-29.56798756,-33.64403229,-36.11262288,-40.9962268,-42.63011879,-45.12870139,-49.41500557,-53.12532016,-55.92826563,-57.71405498,-60.41630791,-62.37727857,-64.45693048,-66.15905662,-68.8814624,-71.40943399,-72.0781427,-76.49647841,-76.205822,-78.37191463,-80.34392011,-81.98790419,-82.92550913,-85.13198703,-85.93223093,-86.21941398,-88.05983883,-89.23497923,-91.23331277,-92.25642078,-93.41677128,-94.44565585,-88.54828187,-74.01762989,-48.05047707,-17.85977213,14.71803994,52.22162985,93.9941347,135.9035631,176.1299154,206.1497402,224.7090709,229.4900034,223.9167049,211.9182196,195.4414633,177.8995713,158.7279986,138.4045551,118.2415434,100.118106,86.96138872,72.33763614,59.08551454,49.44178076,39.82541445,30.77324726,22.27077039,15.29689437,7.321833936,-0.449418541,-4.572945291,-13.25729398,-16.20487594,-19.95616821,-22.12067518,-22.74542621,-26.71410522,-26.13266161,-26.49118357,-24.95921894,-23.12321748,-19.34436223,-16.22862954,-12.96920361,-11.09609557,-8.132897292,-4.647462068,-3.738784872,-2.317468503,-3.290235978,-2.737806571,-3.364680613,-3.533543001,-4.726446308,-8.723665654,-9.77247628,-13.07312657,-17.64072597,-19.06084056,-23.13613476,-27.00965549,-30.00100364,-33.54600325,-37.180639,-40.19480629,-42.7060983,-47.89922589,-49.62843143,-51.5361436,-53.64649972,-56.5150096,-59.35725032,-61.91138018,-63.06591837,-66.0579326,-66.28331829,-69.49675969,-70.86851037,-72.50970125,-74.93874812,-76.8065046,-78.54554333,-80.36316772,-80.2174846,-82.6933462,-84.30815455,-85.33603907,-86.92839389,-88.42850524,-88.94210253,-90.27445095,-88.89039491,-83.55416458,-68.72255516,-43.05545807,-13.89873561,20.04606613,56.95478226,100.2410953,142.0459855,180.4692766,210.3426786,226.8172694,230.2642413,225.2653962,213.0364975,195.2677561,175.7234446,154.4056461,135.3585118,116.7014426,99.60316579,84.68026976,71.61713142,58.41662294,48.40073239,38.63359588,29.84120479,22.12602908,14.90630773,5.794821397,-0.132944962,-5.777601357,-8.908732763,-13.03823956,-18.49848065,-20.48234632,-23.43035071,-24.20201367,-24.49451114,-24.06782849,-20.70061664,-19.71715066,-17.34976388,-12.79230459,-11.4102872,-7.993996177,-6.515959367,-4.093830023,-4.933918751,-3.380430684,-3.071572885,-3.864770248,-5.006485684,-5.138541085,-9.459929388,-9.767069959,-11.59177202,-16.09960986,-18.19469275,-22.04904967,-24.82965193,-27.25159021,-30.49159178,-34.01674075,-36.03852779,-40.97055218,-45.32930395};
float r[500];
int N=500;

void setup() {
  Serial.begin(9600);  
}

void loop() {
  float fs=100;
  double sum;
  double r_zero;
  int fzcp;
  float amax;
  int lmax;
  float lmax1;
  float period;
  float bpm;

  for( int m=0;m<N;m++)
  {
    sum=0;
    for(int n=0;n<N-m;n++)
    {
      sum=sum+(x[n]*x[n+m]);
    }
    r[m]=sum; 
  }
  r_zero=r[0];   
  for( int m=0;m<N;m++)
  {
    r[m]=r[m]/r_zero;
  }
  for( int m=0;m<N;m++)
  {
    if(r[m]>=0 && r[m+1]<=0)
    {
      fzcp=m;
      break;
    }
  }
  amax=r[fzcp];
  for(int i=fzcp+1; i<N; i++)
  {
    if(r[i]>amax)
    {
      amax=r[i];
      lmax1=i;
    }
  }
  //lmax1=fzcp+lmax;
  period=lmax1/fs;
  bpm=60/period;
  Serial.print("Period = ");
  Serial.println(period);
  Serial.print("Beats per minute = ");
  Serial.println(bpm);

  for(int i=0;i<N;i++)
  {
    Serial.print(x[i]);
    Serial.print(' ');
    Serial.println(r[i]*100);
  }
}
